// Generated by CoffeeScript 1.3.3
(function() {
  "use strict";

  angular.module('kaas.controllers', ['kaas.services']).controller("MembersControl", [
    '$scope', 'Members', "$cookieStore", function($scope, Members, $cookieStore) {
      $scope.members = Members.query({
        username: $cookieStore.get('username'),
        api_key: $cookieStore.get('apikey')
      });
      return $scope.select2 = "three";
    }
  ]).controller("MemberDetailControl", [
    "$scope", "$routeParams", "Members", "$cookieStore", function($scope, $routeParams, Members, $cookieStore) {
      $scope.member = Members.get({
        memberId: $routeParams.memberId,
        username: $cookieStore.get('username'),
        api_key: $cookieStore.get('apikey')
      }, function(member) {});
      return $scope.member;
    }
  ]).controller("LoginControl", [
    "$scope", "$location", "Login", "$cookieStore", "$log", function($scope, $location, Login, $cookieStore, $log) {
      $scope.$log = $log;
      $scope.master = {};
      $scope.isClean = function() {
        return angular.equals($scope.master, $scope.member);
      };
      $scope.reset = function() {
        return $scope.member = angular.copy($scope.master);
      };
      $scope.login = function() {
        $log.warn($scope.member);
        return Login.save({
          username: $scope.member.username,
          password: $scope.member.password
        }, function(apitoken) {
          $log.warn(apitoken['apikey']);
          $cookieStore.put('username', apitoken['username']);
          $cookieStore.put('apikey', apitoken['apikey']);
          return $location.path('/');
        });
      };
      return $scope.select2 = "";
    }
  ]).controller("LogoutControl", [
    "$scope", "$location", "Logout", "$cookieStore", "$log", function($scope, $location, Logout, $cookieStore, $log) {
      return Logout.get({}, function() {
        $cookieStore.remove('username');
        return $cookieStore.remove('apikey');
      });
    }
  ]).controller("RegisterControl", [
    "$scope", "$location", "Register", "Checkusername", "$log", function($scope, $location, Register, Checkusername, $log) {
      $scope.$log = $log;
      $scope.master = {};
      $scope.validusername = function() {
        return Checkusername.get({
          username: $scope.member.username
        }, function(payload) {
          return payload['success'];
        });
      };
      $scope.isClean = function() {
        return angular.equals(master, $scope.member);
      };
      $scope.reset = function() {
        return $scope.member = angular.copy($scope.master);
      };
      $scope.register = function() {
        $log.warn($scope.member);
        return Register.save({
          username: $scope.member.username,
          password: $scope.member.password
        }, function(apitoken) {
          $log.warn(apitoken['apikey']);
          return $location.path('/');
        });
      };
    }
  ]).controller("ProfileControl", [
    "$scope", "$location", "$routeParams", "Members", function($scope, $location, $routeParams, Members) {
      var _this = this;
      $scope.save = function() {
        return Members.get({
          member: $scope.member
        }, function(member) {
          _this.original = member;
          return $scope.member = new Members(self.original);
        });
      };
      $scope.isClean = function() {
        return angular.equals(_this.original, $scope.member);
      };
      $scope.destroy = function() {
        return _this.original.destroy(function() {
          return $location.path('/list');
        });
      };
      return $scope.save = function() {
        return $scope.Members.update(function() {
          return $location.path('/');
        });
      };
    }
  ]);

}).call(this);
